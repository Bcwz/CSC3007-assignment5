<!DOCTYPE html>
  
<html>
    <head>
      <title>OneMap2 XYZ (Default)</title>
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css" />
      <script src="https://cdn.onemap.sg/leaflet/onemap-leaflet.js"></script>
    </head>
    <body onload="fetchPsi()">
      <h1>Singapore Map</h1>
      <div id='mapdiv' style='height:800px;'></div>
    </body>
  <script>
    
    var center = L.bounds([1.56073, 104.11475], [1.16, 103.502]).getCenter();
    var map = L.map('mapdiv').setView([center.x, center.y], 12);

    var basemap = L.tileLayer('https://maps-{s}.onemap.sg/v3/Grey/{z}/{x}/{y}.png', {
        detectRetina: true,
        maxZoom: 18,
        minZoom: 11,
        //Do not remove this attribution
        attribution: '<img src="https://www.onemap.gov.sg/docs/maps/images/oneMap64-01.png" style="height:20px;width:20px;"/> OneMap | Map data &copy; contributors, <a href="http://SLA.gov.sg">Singapore Land Authority</a>'
    });    


    map.setMaxBounds([[1.56073, 104.1147], [1.16, 103.502]]);

    basemap.addTo(map);
    

    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition);
      } 
    }

    function showPosition(position) {           
      marker = new L.Marker([position.coords.latitude, position.coords.longitude], {bounceOnAdd: false}).addTo(map);             
      var popup = L.popup()
      .setLatLng([position.coords.latitude, position.coords.longitude]) 
      .setContent('You are here!')
      .openOn(map);         
    }

    async function fetchPsi(){
        let psiURL = "https://api.data.gov.sg/v1/environment/psi";
        let response = await fetch(psiURL);
        let data = await response.json();
        //console.log(data.items[0].readings['psi_twenty_four_hourly']['west'])
        console.log(data.region_metadata)
        let coordinates = JSON.parse(JSON.stringify(data.region_metadata));
        westLat = coordinates[0].label_location.latitude;
        westLong = coordinates[0].label_location.longitude;
        westPsi = data.items[0].readings['psi_twenty_four_hourly']['west'];
        //console.log(westLat, westLong, westPsi)
        var westCirle = L.circleMarker([westLat, westLong], {radius: 100}).addTo(map);
        westCirle.setStyle({color:colorRange(westPsi)})

        nationalLat = coordinates[1].label_location.latitude;
        nationalLong = coordinates[1].label_location.longitude;
        nationalPsi = data.items[0].readings['psi_twenty_four_hourly']['national'];
        var nationalCirle = L.circleMarker([nationalLat, nationalLong], {radius: 100}).addTo(map);
        nationalCirle.setStyle({color:colorRange(nationalPsi)})

        eastLat = coordinates[2].label_location.latitude;
        eastLong = coordinates[2].label_location.longitude;
        eastPsi = data.items[0].readings['psi_twenty_four_hourly']['east'];
        var eastCirle = L.circleMarker([eastLat, eastLong], {radius: 100}).addTo(map);
        eastCirle.setStyle({color:colorRange(eastPsi)})

        centralLat = coordinates[3].label_location.latitude;
        centralLong = coordinates[3].label_location.longitude;
        centralPsi = data.items[0].readings['psi_twenty_four_hourly']['central'];
        var centralCirle = L.circleMarker([centralLat, centralLong], {radius: 100}).addTo(map);
        centralCirle.setStyle({color:colorRange(centralPsi)})

        southLat = coordinates[4].label_location.latitude;
        southLong = coordinates[4].label_location.longitude;
        southPsi = data.items[0].readings['psi_twenty_four_hourly']['south'];
        var southCirle = L.circleMarker([southLat, southLong], {radius: 100}).addTo(map);
        southCirle.setStyle({color:colorRange(southPsi)})

        northLat = coordinates[5].label_location.latitude;
        northLong = coordinates[5].label_location.longitude;
        northPsi = data.items[0].readings['psi_twenty_four_hourly']['north'];
        var northCirle = L.circleMarker([northLat, northLong], {radius: 100}).addTo(map);
        northCirle.setStyle({color:colorRange(northPsi)})
    }

    function colorRange(psiValue){
        if(psiValue <= 20){
            return "#2E7F18"
        }else if(20 < psiValue <= 25){
            return "#45731E"
        }else if(25 < psiValue <= 30){
            return "#675E24"
        }else if(30 < psiValue <= 35){
            return "#8D472B"
        }else if(35 < psiValue <= 40){
            return "#B13433"
        }else if(40 < psiValue <= 45){
            return "#C82538"
        }
        
    }
  </script>
  </html>

